<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel de Senhas - AO VIVO</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #004c99; color: white; text-align: center; margin: 0; padding: 20px; }
        .grid-container { display: grid; grid-template-columns: 50% 50%; max-width: 1000px; margin: 20px auto; gap: 20px; }
        #principal, #historico { padding: 20px; border-radius: 8px; background-color: #003366; }
        #principal { border: 5px solid yellow; display: flex; flex-direction: column; justify-content: center; }
        #senha-atual { font-size: 150px; font-weight: bold; color: yellow; line-height: 1.0; margin-bottom: 10px; }
        #guiche-atual { font-size: 80px; color: white; margin-top: -10px; line-height: 1.0; }
        .item-historico { font-size: 30px; padding: 5px; border-bottom: 1px solid #004c99; }
        
        #aviso-audio { background-color: #ff0000; padding: 20px; cursor: pointer; margin-bottom: 20px; border-radius: 8px; font-weight: bold; font-size: 22px; border: 4px solid white; }

        /* Carrossel de Imagens */
        .container-slides { position: relative; width: 600px; height: 300px; margin: 20px auto; overflow: hidden; border-radius: 12px; border: 4px solid #003366; background-color: #000; }
        .container-slides img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; animation: loop-transicao 20s infinite; }
        .container-slides img:nth-child(1) { animation-delay: 0s; }
        .container-slides img:nth-child(2) { animation-delay: 5s; }
        .container-slides img:nth-child(3) { animation-delay: 10s; }
        .container-slides img:nth-child(4) { animation-delay: 15s; }
        @keyframes loop-transicao { 0% { opacity: 0; } 5% { opacity: 1; } 20% { opacity: 1; } 25% { opacity: 0; } 100% { opacity: 0; } }

        #status-guiches { margin-top: 30px; padding: 15px; background-color: #003366; border-radius: 8px; }
        #lista-status { display: flex; justify-content: space-around; flex-wrap: wrap; }
        .status-item { font-size: 24px; padding: 5px 15px; background-color: #004c99; margin: 5px; border-radius: 4px; border: 1px solid #0056b3; }
        #info-faixa { background-color: #f8bf69; color: #0f0000; font-size: 28px; padding: 10px 0; margin-top: 30px; font-weight: bold; }
    </style>
</head>
<body>

    <audio id="campainha-audio" preload="auto">
        <source src="https://notificationsounds.com/storage/sounds/file-sounds-1150-pristine.mp3" type="audio/mpeg">
    </audio>

    <h1>PAINEL DE ATENDIMENTO</h1>
    
    <div id="aviso-audio">游댉 CLIQUE AQUI PARA ATIVAR O SOM (VOLUME M츼XIMO) 游댉</div>

    <div class="grid-container">
        <div id="principal">
            <div style="font-size: 24px;">SENHA</div>
            <div id="senha-atual">AGUARDANDO</div>
            <div style="font-size: 24px; margin-top: 20px;">MESA</div>
            <div id="guiche-atual">--</div>
        </div>
        <div id="historico">
            <div style="font-size: 35px; font-weight: bold;">칔LTIMAS CHAMADAS</div>
            <div id="lista-historico"><div class="item-historico">Nenhuma chamada recente.</div></div>
        </div>
    </div>

    <div class="container-slides">
        <img src="Logo_principal - LIMA CAMPOS 2025 - brilho contorno.png" alt="pref.lima campos">
        <img src="semed.jpeg" alt="Semed">
        <img src="SEMJUV.jpg" alt="Semjuv">
        <img src="CENTRO DE CAPACITA칂츾O PJ.png" alt="ccpj">
    </div>

    <div id="status-guiches">
        <h3>Status Mesas Ativas</h3>
        <div id="lista-status">
            <div id="status-01" class="status-item">Mesa 01: --</div>
            <div id="status-02" class="status-item">Mesa 02: --</div>
        </div>
    </div>
    
    <div id="info-faixa">
        <marquee scrollamount="10">PARA SOLUCIONAR D칔VIDAS: WHATSAPP (99) 98469-5378 | INSTAGRAM: @semjuvlc</marquee>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        /* ALTERA칂츾O PARA REDE: 
           Ao n칚o passar uma URL para io(), ele tenta se conectar 
           automaticamente ao servidor que est치 servindo a p치gina.
        */
        const socket = io(); 

        const senhaAtual = document.getElementById('senha-atual');
        const guicheAtual = document.getElementById('guiche-atual');
        const listaHistorico = document.getElementById('lista-historico');
        const avisoAudio = document.getElementById('aviso-audio');
        const campainha = document.getElementById('campainha-audio');

        let audioLiberado = false;
        let ultimaSenha = "";

        async function chamarPainel(senha, mesa) {
            if (!audioLiberado) return;

            try {
                campainha.volume = 1.0; 

                for (let i = 0; i < 2; i++) {
                    campainha.currentTime = 0;
                    await campainha.play();
                    await new Promise(r => setTimeout(r, 1200)); 
                }

                const texto = senha.startsWith('P') ? "Priorit치ria" : "Normal";
                const num = senha.split('-')[1] || senha;
                const frase = `Aten칞칚o. Senha ${texto} ${num}. Mesa ${mesa}.`;
                
                const utterance = new SpeechSynthesisUtterance(frase);
                utterance.lang = 'pt-BR';
                utterance.volume = 1.0; 
                utterance.rate = 0.9;   
                
                window.speechSynthesis.speak(utterance);
            } catch (e) {
                console.error("Erro no 치udio:", e);
            }
        }

        avisoAudio.addEventListener('click', () => {
            audioLiberado = true;
            avisoAudio.style.display = 'none';
            campainha.play().then(() => {
                campainha.pause();
                campainha.currentTime = 0;
            }).catch(()=>{});
        });

        socket.on('atualizarPainel', (data) => {
            const chamada = data.ultimaChamada;
            if (chamada && chamada.id !== ultimaSenha) {
                ultimaSenha = chamada.id;
                senhaAtual.textContent = chamada.id;
                guicheAtual.textContent = chamada.guiche; 
                chamarPainel(chamada.id, chamada.guiche);
            }

            if (data.historico) {
                listaHistorico.innerHTML = data.historico.slice(0, 2).map(item => 
                    `<div class="item-historico">SENHA ${item.id}, MESA ${item.guiche}</div>`
                ).join('');
            }
        });
    </script>
</body>
</html>